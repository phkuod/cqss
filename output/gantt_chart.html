<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CQSS Project Gantt Chart</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            width: 100%;
            height: calc(100vh - 40px);
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        
        .header {
            text-align: center;
            padding: 15px 20px;
            border-bottom: 2px solid #e9ecef;
            flex-shrink: 0;
            background: white;
            border-radius: 8px 8px 0 0;
        }
        
        .header h1 {
            color: #343a40;
            margin: 0;
            font-size: 2.2em;
        }
        
        .header p {
            color: #6c757d;
            margin: 8px 0 0 0;
            font-size: 1.0em;
        }
        
        .gantt-container {
            flex: 1;
            overflow: auto;
            border: none;
            position: relative;
        }
        
        .gantt-chart {
            width: 100%;
            height: 100%;
        }
        
        /* Enhanced scrollbar styling */
        .gantt-container {
            scrollbar-width: thin;
            scrollbar-color: #6c757d #f8f9fa;
        }
        
        .gantt-container::-webkit-scrollbar {
            width: 16px;
            height: 16px;
        }
        
        .gantt-container::-webkit-scrollbar-track {
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .gantt-container::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #6c757d 0%, #5a6268 100%);
            border-radius: 8px;
            border: 2px solid #f8f9fa;
            min-height: 20px;
        }
        
        .gantt-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #5a6268 0%, #495057 100%);
        }
        
        .gantt-container::-webkit-scrollbar-thumb:active {
            background: linear-gradient(180deg, #495057 0%, #343a40 100%);
        }
        
        .gantt-container::-webkit-scrollbar-corner {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
        }
        
        /* Scrollbar arrows */
        .gantt-container::-webkit-scrollbar-button {
            width: 16px;
            height: 16px;
            background: #e9ecef;
            border: 1px solid #dee2e6;
        }
        
        .gantt-container::-webkit-scrollbar-button:hover {
            background: #dee2e6;
        }
        
        .axis {
            font-size: 12px;
        }
        
        .axis-label {
            font-size: 14px;
            font-weight: bold;
            fill: #495057;
        }
        
        .project-row {
            cursor: pointer;
        }
        
        .project-label {
            font-size: 13px;
            font-weight: 500;
            fill: #343a40;
        }
        
        .preparing-bar {
            fill: #6c757d;
            stroke: #495057;
            stroke-width: 1;
        }
        
        .execution-bar {
            stroke: #343a40;
            stroke-width: 1;
        }
        
        .progress-bar {
            opacity: 0.8;
        }
        
        .priority-critical { fill: #dc3545; }
        .priority-high { fill: #fd7e14; }
        .priority-medium { fill: #ffc107; }
        .priority-low { fill: #28a745; }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px;
            border-radius: 6px;
            font-size: 13px;
            line-height: 1.4;
            max-width: 300px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            pointer-events: none;
        }
        
        .tooltip-title {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 8px;
            color: #fff;
        }
        
        .tooltip-item {
            margin: 4px 0;
        }
        
        .legend {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #495057;
        }
        
        .legend-color {
            width: 20px;
            height: 15px;
            border-radius: 3px;
            border: 1px solid #ccc;
        }

        .info-bar {
            padding: 10px 20px;
            background: #e9ecef;
            border-bottom: 1px solid #dee2e6;
            text-align: center;
            flex-shrink: 0;
            font-size: 14px;
            color: #495057;
        }

        .scroll-hint {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CQSS Project Gantt Chart</h1>
            <p>Cyber Query Security System - Project Timeline Overview</p>
        </div>
        
        <div class="info-bar">
            <span id="project-count">Loading projects...</span>
            <div class="scroll-hint">ðŸ’¡ Use scrollbars or Shift + mouse wheel for horizontal scroll, arrow keys for navigation</div>
        </div>
        
        <div class="gantt-container" id="gantt-container">
            <svg class="gantt-chart"></svg>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #6c757d;"></div>
                <span>Preparing</span>
            </div>
            <div class="legend-item">
                <div class="legend-color priority-critical"></div>
                <span>Critical Priority</span>
            </div>
            <div class="legend-item">
                <div class="legend-color priority-high"></div>
                <span>High Priority</span>
            </div>
            <div class="legend-item">
                <div class="legend-color priority-medium"></div>
                <span>Medium Priority</span>
            </div>
            <div class="legend-item">
                <div class="legend-color priority-low"></div>
                <span>Low Priority</span>
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip" style="display: none;"></div>
    
    <script>
        function initChart() {
            // Project data will be embedded here
            const projectData = [
  {
    "id": "project_0",
    "name": "Project Alpha Security Enhancement",
    "category": "Security",
    "priority": "Critical",
    "description": "Implement new multi-factor authentication system",
    "team_lead": "John Smith",
    "preparing_stage": {
      "start": "2024-01-15T00:00:00",
      "end": "2024-02-15T00:00:00",
      "duration_days": 31
    },
    "execution_stage": {
      "start": "2024-02-15T00:00:00",
      "end": "2024-05-15T00:00:00",
      "duration_days": 90,
      "progress_percent": 75
    },
    "total_duration_days": 121
  },
  {
    "id": "project_1",
    "name": "Project Beta Database Migration",
    "category": "Infrastructure",
    "priority": "High",
    "description": "Database migration and performance optimization",
    "team_lead": "Jane Doe",
    "preparing_stage": {
      "start": "2024-02-01T00:00:00",
      "end": "2024-03-01T00:00:00",
      "duration_days": 29
    },
    "execution_stage": {
      "start": "2024-03-01T00:00:00",
      "end": "2024-06-01T00:00:00",
      "duration_days": 92,
      "progress_percent": 45
    },
    "total_duration_days": 121
  },
  {
    "id": "project_2",
    "name": "Project Gamma Frontend Redesign",
    "category": "Development",
    "priority": "High",
    "description": "Complete frontend redesign and UX improvements",
    "team_lead": "Mike Johnson",
    "preparing_stage": {
      "start": "2024-01-01T00:00:00",
      "end": "2024-01-15T00:00:00",
      "duration_days": 14
    },
    "execution_stage": {
      "start": "2024-01-15T00:00:00",
      "end": "2024-04-01T00:00:00",
      "duration_days": 77,
      "progress_percent": 90
    },
    "total_duration_days": 91
  },
  {
    "id": "project_3",
    "name": "Project Delta GDPR Compliance",
    "category": "Compliance",
    "priority": "Critical",
    "description": "GDPR compliance implementation and audit",
    "team_lead": "Sarah Wilson",
    "preparing_stage": {
      "start": "2024-03-01T00:00:00",
      "end": "2024-03-15T00:00:00",
      "duration_days": 14
    },
    "execution_stage": {
      "start": "2024-03-15T00:00:00",
      "end": "2024-07-01T00:00:00",
      "duration_days": 108,
      "progress_percent": 30
    },
    "total_duration_days": 122
  },
  {
    "id": "project_4",
    "name": "Project Epsilon AI Research",
    "category": "Research",
    "priority": "Medium",
    "description": "AI integration feasibility study and prototyping",
    "team_lead": "David Brown",
    "preparing_stage": {
      "start": "2024-02-15T00:00:00",
      "end": "2024-04-15T00:00:00",
      "duration_days": 60
    },
    "execution_stage": {
      "start": "2024-04-15T00:00:00",
      "end": "2024-08-15T00:00:00",
      "duration_days": 122,
      "progress_percent": 10
    },
    "total_duration_days": 182
  },
  {
    "id": "project_5",
    "name": "Project Zeta Cloud Migration",
    "category": "Infrastructure",
    "priority": "High",
    "description": "Complete cloud infrastructure migration",
    "team_lead": "Lisa Chen",
    "preparing_stage": {
      "start": "2024-01-20T00:00:00",
      "end": "2024-02-20T00:00:00",
      "duration_days": 31
    },
    "execution_stage": {
      "start": "2024-02-20T00:00:00",
      "end": "2024-05-20T00:00:00",
      "duration_days": 90,
      "progress_percent": 65
    },
    "total_duration_days": 121
  },
  {
    "id": "project_6",
    "name": "Project Eta Mobile App Development",
    "category": "Development",
    "priority": "Medium",
    "description": "Native mobile application development",
    "team_lead": "Robert Taylor",
    "preparing_stage": {
      "start": "2024-02-10T00:00:00",
      "end": "2024-03-10T00:00:00",
      "duration_days": 29
    },
    "execution_stage": {
      "start": "2024-03-10T00:00:00",
      "end": "2024-06-10T00:00:00",
      "duration_days": 92,
      "progress_percent": 55
    },
    "total_duration_days": 121
  },
  {
    "id": "project_7",
    "name": "Project Theta API Gateway Implementation",
    "category": "Development",
    "priority": "High",
    "description": "Implement unified API gateway architecture",
    "team_lead": "Emma Davis",
    "preparing_stage": {
      "start": "2024-01-05T00:00:00",
      "end": "2024-01-25T00:00:00",
      "duration_days": 20
    },
    "execution_stage": {
      "start": "2024-01-25T00:00:00",
      "end": "2024-04-25T00:00:00",
      "duration_days": 91,
      "progress_percent": 80
    },
    "total_duration_days": 111
  },
  {
    "id": "project_8",
    "name": "Project Iota Data Analytics Platform",
    "category": "Analytics",
    "priority": "Medium",
    "description": "Build comprehensive data analytics platform",
    "team_lead": "Alex Martinez",
    "preparing_stage": {
      "start": "2024-02-25T00:00:00",
      "end": "2024-03-25T00:00:00",
      "duration_days": 29
    },
    "execution_stage": {
      "start": "2024-03-25T00:00:00",
      "end": "2024-07-25T00:00:00",
      "duration_days": 122,
      "progress_percent": 25
    },
    "total_duration_days": 151
  },
  {
    "id": "project_9",
    "name": "Project Kappa Cybersecurity Audit",
    "category": "Security",
    "priority": "Critical",
    "description": "Complete cybersecurity audit and remediation",
    "team_lead": "Jennifer Lee",
    "preparing_stage": {
      "start": "2024-01-30T00:00:00",
      "end": "2024-02-28T00:00:00",
      "duration_days": 29
    },
    "execution_stage": {
      "start": "2024-02-28T00:00:00",
      "end": "2024-05-28T00:00:00",
      "duration_days": 90,
      "progress_percent": 40
    },
    "total_duration_days": 119
  },
  {
    "id": "project_10",
    "name": "Project Lambda Performance Optimization",
    "category": "Infrastructure",
    "priority": "High",
    "description": "System performance optimization and tuning",
    "team_lead": "Mark Anderson",
    "preparing_stage": {
      "start": "2024-02-05T00:00:00",
      "end": "2024-03-05T00:00:00",
      "duration_days": 29
    },
    "execution_stage": {
      "start": "2024-03-05T00:00:00",
      "end": "2024-06-05T00:00:00",
      "duration_days": 92,
      "progress_percent": 70
    },
    "total_duration_days": 121
  },
  {
    "id": "project_11",
    "name": "Project Mu User Training Program",
    "category": "Training",
    "priority": "Low",
    "description": "Comprehensive user training program development",
    "team_lead": "Carol White",
    "preparing_stage": {
      "start": "2024-03-10T00:00:00",
      "end": "2024-04-10T00:00:00",
      "duration_days": 31
    },
    "execution_stage": {
      "start": "2024-04-10T00:00:00",
      "end": "2024-07-10T00:00:00",
      "duration_days": 91,
      "progress_percent": 15
    },
    "total_duration_days": 122
  },
  {
    "id": "project_12",
    "name": "Project Nu Backup System Upgrade",
    "category": "Infrastructure",
    "priority": "Medium",
    "description": "Backup and disaster recovery system upgrade",
    "team_lead": "Kevin Rodriguez",
    "preparing_stage": {
      "start": "2024-01-25T00:00:00",
      "end": "2024-02-25T00:00:00",
      "duration_days": 31
    },
    "execution_stage": {
      "start": "2024-02-25T00:00:00",
      "end": "2024-05-25T00:00:00",
      "duration_days": 90,
      "progress_percent": 85
    },
    "total_duration_days": 121
  },
  {
    "id": "project_13",
    "name": "Project Xi Integration Testing",
    "category": "Testing",
    "priority": "High",
    "description": "Comprehensive integration testing framework",
    "team_lead": "Michelle Brown",
    "preparing_stage": {
      "start": "2024-02-20T00:00:00",
      "end": "2024-03-20T00:00:00",
      "duration_days": 29
    },
    "execution_stage": {
      "start": "2024-03-20T00:00:00",
      "end": "2024-06-20T00:00:00",
      "duration_days": 92,
      "progress_percent": 60
    },
    "total_duration_days": 121
  },
  {
    "id": "project_14",
    "name": "Project Omicron Documentation Update",
    "category": "Documentation",
    "priority": "Low",
    "description": "Update all technical documentation and guides",
    "team_lead": "Thomas Garcia",
    "preparing_stage": {
      "start": "2024-03-05T00:00:00",
      "end": "2024-04-05T00:00:00",
      "duration_days": 31
    },
    "execution_stage": {
      "start": "2024-04-05T00:00:00",
      "end": "2024-07-05T00:00:00",
      "duration_days": 91,
      "progress_percent": 20
    },
    "total_duration_days": 122
  },
  {
    "id": "project_15",
    "name": "Project Pi Quality Assurance",
    "category": "Testing",
    "priority": "Medium",
    "description": "Complete quality assurance testing suite",
    "team_lead": "Rachel Kim",
    "preparing_stage": {
      "start": "2024-01-10T00:00:00",
      "end": "2024-02-10T00:00:00",
      "duration_days": 31
    },
    "execution_stage": {
      "start": "2024-02-10T00:00:00",
      "end": "2024-05-10T00:00:00",
      "duration_days": 90,
      "progress_percent": 95
    },
    "total_duration_days": 121
  },
  {
    "id": "project_16",
    "name": "Project Rho Vendor Management",
    "category": "Operations",
    "priority": "Low",
    "description": "Vendor management system implementation",
    "team_lead": "Steven Thompson",
    "preparing_stage": {
      "start": "2024-02-28T00:00:00",
      "end": "2024-03-28T00:00:00",
      "duration_days": 29
    },
    "execution_stage": {
      "start": "2024-03-28T00:00:00",
      "end": "2024-06-28T00:00:00",
      "duration_days": 92,
      "progress_percent": 35
    },
    "total_duration_days": 121
  },
  {
    "id": "project_17",
    "name": "Project Sigma Monitoring System",
    "category": "Infrastructure",
    "priority": "High",
    "description": "Advanced monitoring and alerting system",
    "team_lead": "Amanda Jackson",
    "preparing_stage": {
      "start": "2024-01-15T00:00:00",
      "end": "2024-02-15T00:00:00",
      "duration_days": 31
    },
    "execution_stage": {
      "start": "2024-02-15T00:00:00",
      "end": "2024-05-15T00:00:00",
      "duration_days": 90,
      "progress_percent": 50
    },
    "total_duration_days": 121
  },
  {
    "id": "project_18",
    "name": "Project Tau DevOps Pipeline",
    "category": "Development",
    "priority": "High",
    "description": "CI/CD pipeline implementation and automation",
    "team_lead": "Ryan Wilson",
    "preparing_stage": {
      "start": "2024-02-12T00:00:00",
      "end": "2024-03-12T00:00:00",
      "duration_days": 29
    },
    "execution_stage": {
      "start": "2024-03-12T00:00:00",
      "end": "2024-06-12T00:00:00",
      "duration_days": 92,
      "progress_percent": 75
    },
    "total_duration_days": 121
  },
  {
    "id": "project_19",
    "name": "Project Upsilon Load Testing",
    "category": "Testing",
    "priority": "Medium",
    "description": "Comprehensive load testing and optimization",
    "team_lead": "Nicole Harris",
    "preparing_stage": {
      "start": "2024-03-01T00:00:00",
      "end": "2024-04-01T00:00:00",
      "duration_days": 31
    },
    "execution_stage": {
      "start": "2024-04-01T00:00:00",
      "end": "2024-07-01T00:00:00",
      "duration_days": 91,
      "progress_percent": 30
    },
    "total_duration_days": 122
  }
];
            const dateRange = {
  "min_date": "2024-01-01T00:00:00",
  "max_date": "2024-08-15T00:00:00"
};
            
            document.getElementById('project-count').textContent = `${projectData.length} projects loaded`;
        
        // Chart configuration optimized for both horizontal and vertical scrolling
        const margin = { top: 50, right: 50, bottom: 100, left: 320 };
        const width = 3000 - margin.left - margin.right; // Wider for more horizontal scroll range
        const height = projectData.length * 65 - margin.top - margin.bottom; // Responsive height
        const barHeight = 30;
        const rowHeight = 65;
        
        // Create SVG
        const svg = d3.select('.gantt-chart')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.top + margin.bottom);
        
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        // Parse dates
        const parseTime = d3.timeParse('%Y-%m-%dT%H:%M:%S');
        const minDate = parseTime(dateRange.min_date);
        const maxDate = parseTime(dateRange.max_date);
        
        // Calculate 2-week range starting from Sunday
        function getStartOfWeek(date) {
            const d = new Date(date);
            const day = d.getDay(); // 0 = Sunday, 1 = Monday, etc.
            const diff = d.getDate() - day;
            return new Date(d.setDate(diff));
        }
        
        function getEndOfWeek(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() + (6 - day);
            return new Date(d.setDate(diff));
        }
        
        // Extended timeline for better horizontal scrolling (4 weeks)
        const startOfFirstWeek = getStartOfWeek(minDate);
        const endOfExtendedPeriod = new Date(startOfFirstWeek);
        endOfExtendedPeriod.setDate(startOfFirstWeek.getDate() + 27); // 28 days total (4 weeks)
        
        const paddedMinDate = startOfFirstWeek;
        const paddedMaxDate = endOfExtendedPeriod;
        
        // Scales
        const xScale = d3.scaleTime()
            .domain([paddedMinDate, paddedMaxDate])
            .range([0, width]);
        
        const yScale = d3.scaleBand()
            .domain(projectData.map(d => d.name))
            .range([0, height])
            .padding(0.1);
        
        // Priority color scale
        const priorityColors = {
            'Critical': '#dc3545',
            'High': '#fd7e14',
            'Medium': '#ffc107',
            'Low': '#28a745'
        };
        
        // Create tooltip
        const tooltip = d3.select('#tooltip');
        
        // Add axes with daily ticks
        const xAxis = d3.axisBottom(xScale)
            .tickFormat(d => {
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                return dayNames[d.getDay()] + '\n' + d3.timeFormat('%m/%d')(d);
            })
            .ticks(d3.timeDay.every(1));
        
        g.append('g')
            .attr('class', 'axis')
            .attr('transform', `translate(0,${height})`)
            .call(xAxis)
            .selectAll('text')
            .style('text-anchor', 'middle')
            .style('font-size', '10px')
            .attr('dy', '1em');
        
        // Add week separators
        const weekTicks = d3.timeWeek.range(paddedMinDate, paddedMaxDate, 1);
        g.selectAll('.week-separator')
            .data(weekTicks)
            .enter()
            .append('line')
            .attr('class', 'week-separator')
            .attr('x1', d => xScale(d))
            .attr('x2', d => xScale(d))
            .attr('y1', 0)
            .attr('y2', height)
            .style('stroke', '#007bff')
            .style('stroke-width', 2)
            .style('opacity', 0.7);
        
        const yAxis = d3.axisLeft(yScale);
        
        g.append('g')
            .attr('class', 'axis')
            .call(yAxis);
        
        // Add daily grid lines
        g.append('g')
            .attr('class', 'grid')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(xScale)
                .tickSize(-height)
                .tickFormat('')
                .ticks(d3.timeDay.every(1))
            )
            .style('stroke-dasharray', '2,2')
            .style('opacity', 0.2);
        
        // Add weekend highlighting
        const weekendDays = d3.timeDay.range(paddedMinDate, paddedMaxDate, 1)
            .filter(d => d.getDay() === 0 || d.getDay() === 6); // Sunday = 0, Saturday = 6
        
        g.selectAll('.weekend-highlight')
            .data(weekendDays)
            .enter()
            .append('rect')
            .attr('class', 'weekend-highlight')
            .attr('x', d => xScale(d))
            .attr('y', 0)
            .attr('width', xScale(new Date(paddedMinDate.getTime() + 24*60*60*1000)) - xScale(paddedMinDate))
            .attr('height', height)
            .style('fill', '#f8f9fa')
            .style('opacity', 0.5);
        
        // Create project groups
        const projectGroups = g.selectAll('.project-group')
            .data(projectData)
            .enter()
            .append('g')
            .attr('class', 'project-group')
            .attr('transform', d => `translate(0,${yScale(d.name)})`);
        
        // Add preparing stage bars
        projectGroups.append('rect')
            .attr('class', 'preparing-bar')
            .attr('x', d => xScale(parseTime(d.preparing_stage.start)))
            .attr('y', (yScale.bandwidth() - barHeight) / 2)
            .attr('width', d => xScale(parseTime(d.preparing_stage.end)) - xScale(parseTime(d.preparing_stage.start)))
            .attr('height', barHeight);
        
        // Add execution stage background bars
        projectGroups.append('rect')
            .attr('class', 'execution-bar')
            .attr('x', d => xScale(parseTime(d.execution_stage.start)))
            .attr('y', (yScale.bandwidth() - barHeight) / 2)
            .attr('width', d => xScale(parseTime(d.execution_stage.end)) - xScale(parseTime(d.execution_stage.start)))
            .attr('height', barHeight)
            .attr('fill', d => priorityColors[d.priority] || '#6c757d')
            .attr('opacity', 0.3);
        
        // Add execution stage progress bars
        projectGroups.append('rect')
            .attr('class', 'progress-bar execution-bar')
            .attr('x', d => xScale(parseTime(d.execution_stage.start)))
            .attr('y', (yScale.bandwidth() - barHeight) / 2)
            .attr('width', d => {
                const totalWidth = xScale(parseTime(d.execution_stage.end)) - xScale(parseTime(d.execution_stage.start));
                return totalWidth * (d.execution_stage.progress_percent / 100);
            })
            .attr('height', barHeight)
            .attr('fill', d => priorityColors[d.priority] || '#6c757d')
            .style('cursor', 'pointer')
            .on('mouseover', function(event, d) {
                tooltip.style('display', 'block')
                    .html(`
                        <div class="tooltip-title">${d.name}</div>
                        <div class="tooltip-item"><strong>Category:</strong> ${d.category}</div>
                        <div class="tooltip-item"><strong>Priority:</strong> ${d.priority}</div>
                        <div class="tooltip-item"><strong>Team Lead:</strong> ${d.team_lead}</div>
                        <div class="tooltip-item"><strong>Progress:</strong> ${d.execution_stage.progress_percent}%</div>
                        <div class="tooltip-item"><strong>Description:</strong> ${d.description}</div>
                        <div class="tooltip-item"><strong>Preparing:</strong> ${d.preparing_stage.start.split('T')[0]} to ${d.preparing_stage.end.split('T')[0]}</div>
                        <div class="tooltip-item"><strong>Execution:</strong> ${d.execution_stage.start.split('T')[0]} to ${d.execution_stage.end.split('T')[0]}</div>
                    `);
            })
            .on('mousemove', function(event) {
                tooltip.style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 10) + 'px');
            })
            .on('mouseout', function() {
                tooltip.style('display', 'none');
            })
            .on('click', function(event, d) {
                alert(`Project Details:\n\nName: ${d.name}\nCategory: ${d.category}\nPriority: ${d.priority}\nTeam Lead: ${d.team_lead}\nProgress: ${d.execution_stage.progress_percent}%\nDescription: ${d.description}`);
            });
        
        // Add project names to execution bars
        projectGroups.append('text')
            .attr('x', d => {
                const startX = xScale(parseTime(d.execution_stage.start));
                const endX = xScale(parseTime(d.execution_stage.end));
                return startX + (endX - startX) / 2;
            })
            .attr('y', (yScale.bandwidth() - barHeight) / 2 + barHeight / 2 - 4)
            .attr('dy', '0.35em')
            .attr('text-anchor', 'middle')
            .style('font-size', '13px')
            .style('font-weight', 'bold')
            .style('fill', 'white')
            .style('text-shadow', '1px 1px 3px rgba(0,0,0,0.9)')
            .text(d => {
                const barWidth = xScale(parseTime(d.execution_stage.end)) - xScale(parseTime(d.execution_stage.start));
                const maxChars = Math.floor(barWidth / 8); // Estimate characters that fit
                return d.name.length > maxChars && maxChars > 3 ? 
                    d.name.substring(0, maxChars - 3) + '...' : d.name;
            });

        // Add progress percentage labels at end of progress bar
        projectGroups.append('text')
            .attr('x', d => {
                const startX = xScale(parseTime(d.execution_stage.start));
                const totalWidth = xScale(parseTime(d.execution_stage.end)) - startX;
                const progressWidth = totalWidth * (d.execution_stage.progress_percent / 100);
                // Position at the end of the progress bar, with a small offset
                return startX + progressWidth + 5;
            })
            .attr('y', (yScale.bandwidth() - barHeight) / 2 + barHeight / 2)
            .attr('dy', '0.35em')
            .attr('text-anchor', 'start')
            .style('font-size', '11px')
            .style('font-weight', 'bold')
            .style('fill', '#343a40')
            .style('text-shadow', '1px 1px 2px rgba(255,255,255,0.8)')
            .text(d => {
                const barWidth = xScale(parseTime(d.execution_stage.end)) - xScale(parseTime(d.execution_stage.start));
                const progressWidth = barWidth * (d.execution_stage.progress_percent / 100);
                // Show percentage if there's enough space and progress > 0
                return progressWidth > 20 && d.execution_stage.progress_percent > 0 ? `${d.execution_stage.progress_percent}%` : '';
            });
        
        // Add chart title
        svg.append('text')
            .attr('x', (width + margin.left + margin.right) / 2)
            .attr('y', 30)
            .attr('text-anchor', 'middle')
            .style('font-size', '16px')
            .style('font-weight', 'bold')
            .style('fill', '#343a40')
            .text('Project Timeline and Progress Overview');

        // Enhanced scroll behavior
        const container = document.getElementById('gantt-container');
        if (container) {
            // Enable smooth horizontal scrolling with Shift + mouse wheel
            container.addEventListener('wheel', function(e) {
                if (e.shiftKey) {
                    e.preventDefault();
                    container.scrollLeft += e.deltaY;
                }
            });
            
            // Add keyboard navigation
            container.addEventListener('keydown', function(e) {
                const scrollAmount = 50;
                switch(e.key) {
                    case 'ArrowLeft':
                        e.preventDefault();
                        container.scrollLeft -= scrollAmount;
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        container.scrollLeft += scrollAmount;
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        container.scrollTop -= scrollAmount;
                        break;
                    case 'ArrowDown':
                        e.preventDefault();
                        container.scrollTop += scrollAmount;
                        break;
                }
            });
            
            // Make container focusable for keyboard navigation
            container.setAttribute('tabindex', '0');
        }
        }

        // Load D3.js and initialize chart
        (function(){
            var script = document.createElement('script');
            script.src = 'https://d3js.org/d3.v7.min.js';
            script.onload = initChart;
            script.onerror = function() {
                alert('Cannot load D3.js from CDN. This chart requires an internet connection.');
            };
            document.head.appendChild(script);
        })();
    </script>
</body>
</html>