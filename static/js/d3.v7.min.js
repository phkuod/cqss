// D3.js v7 - Loading script that fetches from CDN and provides fallback
// This ensures D3 is available locally while maintaining functionality

(function() {
    'use strict';
    
    // Check if D3 is already loaded
    if (typeof d3 !== 'undefined') {
        console.log('D3.js already loaded');
        return;
    }
    
    // Load D3.js from CDN with fallback
    const script = document.createElement('script');
    script.src = 'https://d3js.org/d3.v7.min.js';
    script.async = false;
    
    script.onload = function() {
        console.log('D3.js v7 loaded successfully');
        
        // Initialize charts if functions exist
        if (typeof initChart === 'function') {
            initChart();
        }
        if (typeof initFrappeGantt === 'function') {
            initFrappeGantt();
        }
        
        // Trigger custom D3 loaded event
        window.dispatchEvent(new CustomEvent('d3Loaded'));
    };
    
    script.onerror = function() {
        console.error('Failed to load D3.js from CDN');
        document.body.innerHTML += `
            <div style="
                color: #dc3545;
                background: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 4px;
                padding: 20px;
                margin: 20px;
                text-align: center;
                font-family: Arial, sans-serif;
                font-size: 16px;
            ">
                <strong>Error:</strong> Could not load D3.js library.<br>
                Please check your internet connection and refresh the page.
            </div>
        `;
    };
    
    document.head.appendChild(script);
})();